---
title: "Computational Musicology Portfolio"
author: "Brian Murphy"
date: "2021"
output: 
    flexdashboard::flex_dashboard:
        storyboard: true
        theme: journal
---

```{r setup}
library(tidyverse)
library(plotly) # N.B. Requires the Cairo package
library(spotifyr)
library(compmus)
```

### Having a deeper look at the most **positive** tunes of each decade (playlist) and see if a **chromogram** can tell us more

```{r}
SOY <-
  get_tidy_audio_analysis("7qiZfU4dY1lWllzX7mPBI3") %>% # Change URI.
  compmus_align(bars, segments) %>%                     # Change `bars`
  select(bars) %>%                                      #   in all three
  unnest(bars) %>%                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) %>%
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )
```

```{r}
SOY %>%
  compmus_gather_timbre() %>%
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  scale_fill_viridis_c() +                              
  theme_classic()
```

***

For some reason I haven't managed to get all the cepstrograms next to eachother... Does someone have any tips/code I can use? 


### The Happiest of the Decades 

Throughout the decades we have seen happier and sadder times. Each decade has been marked by the tough times and the good times, as are we. Music has long been a means of expression for human beings, in both listening as playing. So maybe music can tell us more about the emotions of a decade's zeitgeist, which brings me to my question; which decade was the happiest, and what can the popular music released in that decade tell us about the collective happiness?

### Emotional Stats

```{r happy}
AO_60s <- get_playlist_audio_features("", "37i9dQZF1DXaKIA8E7WcJj")
AO_70s <- get_playlist_audio_features("", "37i9dQZF1DWTJ7xPn4vNaz")
AO_80s <- get_playlist_audio_features("", "37i9dQZF1DX4UtSsGT1Sbe")
AO_90s <- get_playlist_audio_features("", "37i9dQZF1DXbTxeAdrVG2l")
AO_00s <- get_playlist_audio_features("", "37i9dQZF1DX4o1oenSJRJd")
AO_10s <- get_playlist_audio_features("", "37i9dQZF1DX5Ejj0EkURtP")
AO_decades <-
  AO_60s %>% top_n(20, track.popularity) %>%
  mutate(country = "The 60s") %>%
  bind_rows(AO_70s %>% top_n(20, track.popularity) %>% mutate(country = "The 70s")) %>%
  bind_rows(AO_80s %>% top_n(20, track.popularity) %>% mutate(country = "The 80s")) %>% 
  bind_rows(AO_90s %>% top_n(20, track.popularity) %>% mutate(country = "The 90s")) %>%
  bind_rows(AO_00s %>% top_n(20, track.popularity) %>% mutate(country = "The 00s")) %>%
  bind_rows(AO_10s %>% top_n(20, track.popularity) %>% mutate(country = "The 10s")) %>%
  mutate(
    country = fct_relevel(country, "The 10s", "The 00s", "The 90s", "The 80s", "The 70s", "The 60s")
  )
  


  
  happy_stats <-
  AO_decades %>%  
  ggplot(                          # Set up the plot.
    aes(
      x = valence,
      y = track.popularity,
      colour = mode,
      size = danceability,
      label = track.name           # Labels will be interactively visible.
    )
  ) +
  geom_point(shape = ".") +                   # Scatter plot.
  geom_rug(size = 0.1) +           # Add 'fringes' to show data distribution.
  facet_wrap(~country) +           # Separate charts per country.
  scale_x_continuous(              # Fine-tune the x axis.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),        # Use grid-lines for quadrants only.
    minor_breaks = NULL            # Remove 'minor' grid-lines.
  ) +
  scale_y_continuous(              # Fine-tune the y axis in the same way.
    limits = c(60, 90),
    breaks = c(0, 0.50, 1),
    minor_breaks = NULL
  ) +
  scale_colour_viridis_c(          # Use the cividis palette
    option = "E",                  # Qualitative set.
    alpha = 0.8,                   # Include some transparency
    guide = "none"
  ) +
  scale_size_continuous(           # Fine-tune the sizes of each point.
    guide = "none"                # Remove the legend for size.
  ) +
  theme_classic() +                  # Use a simpler theme.
  labs(                            # Make the titles nice.
    x = "Valence",
    y = "Popularity"
  )
ggplotly(happy_stats)
```

***

These graphs show the valence (x axis) and the [popularity (y axis) of Spotify's own "All Out" playlists of each decade from the 60s up till the 10s. The size of the dots indicates the danceability and the colour indicates the mode (major/minor) of the song, 1 for major, 0 for minor.


### Conclusions I do not have yet

- in modern music more minor
- 00s more danceable?
- 